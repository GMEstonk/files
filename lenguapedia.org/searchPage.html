<!DOCTYPE html>
<html>
<head>
  <title>Translate Wikis</title>
  <style>
select{
  width: 10vmax;
}
[id="lang-table"]>td{
  border-width:1px;
  border-style:solid;
  border-color:rgba(0,0,0,0.5);
}
  </style>
</head>

<body>
<center>
  <h1>Translate Wikis</h1>
  <p>Select Languages</p><br><br>
<table><tr><td>From: </td><td><select id="wiki-prefix"></select></td></tr>

<tr><td>To: </td><td><select id="lang-to"></select></td></tr>
</table>
<br><br>
<table id="lang-table"></table>
<script>
let wikiList = {};

let langList = {};

document.getElementById('lang-to').onchange=function(){getLinks();};
document.getElementById('wiki-prefix').onchange=function(){getLinks();};
  
function getLinks(){
  let tryWiki = document.getElementById('wiki-prefix').value;
  let tryLang = document.getElementById('lang-to').value;
  let table='<tr><th>From Language</th><th>To Language</th><th>Wiki Link</th></tr>';
  const table_length=table.length;
  let wikiCodes = Object.keys(wikiList);
  const wikiCodes_length = wikiCodes.length;
  let langCodes = Object.keys(langList);
  const langCodes_length = langCodes.length;
  for(let i=0;i<wikiCodes_length;i++){
    if((!wikiCodes[i].includes(tryWiki))||(!tryWiki.includes(wikiCodes[i]))){continue;}
    for(let x=0;x<langCodes_length;x++){//try{
      if((!langCodes[x].includes(tryLang))||(!tryLang.includes(langCodes[x]))){continue;}
        table+=makeRow(wikiCodes[i],langCodes[x]);
    }//catch(e){continue;}}
  }
  if(table.length>table_length){
    document.getElementById('lang-table').innerHTML=table;
  }else{
    document.getElementById('lang-table').innerHTML='';   
  }
}
    function makeRow(wikiPrefix,langTo){
        
        return `<tr><td>`+wikiList[wikiPrefix]+`</td><td>`+langList[langTo]+`</td><td><a target="_blank" href="https://`+langTo+`.lenguapedia.org?langs=`+wikiPrefix+`.`+langTo+`">https://`+langTo+`.lenguapedia.org?langs=`+wikiPrefix+`.`+langTo+`</a></td></tr>`;    
    }
    
    async function corsFetchText(url){
    
        return await(await fetch('https://api.lenguapedia.org/corsFetch/'+url)).text();
    
    }
    
    void async function populateLists(){

        let wikiPage=await corsFetchText('https://en.wikipedia.org/wiki/List_of_Wikipedias');
        const parser = new DOMParser();


        let wikiDoc = parser.parseFromString(wikiPage, "text/html");
        let wikiDropdown = ``;
        let wikiRows = wikiDoc.getElementsByClassName('wikitable')[1].getElementsByTagName('tr');
        const wikiRows_length=wikiRows.length;
        for(let i=1;i<wikiRows_length;i++){try{
            let code = wikiRows[i].getElementsByTagName('td')[3].textContent.trim();
            let full = wikiRows[i].getElementsByTagName('td')[1].textContent.trim();
            if(code=='zh'){full='Chinese';}
            wikiList[code]=full;
            wikiDropdown+=`<option value="`+code+`">`+code+':'+full+`</option>`;
        }catch(e){continue;}}     
        document.getElementById('wiki-prefix').innerHTML=wikiDropdown;


          async function corsFetchText(url){
    
        return await(await fetch('https://api.lenguapedia.org/corsFetch/'+url)).text();
    
    }

        let langPage=await corsFetchText('https://translate.google.com');
        const lparser = new DOMParser();


        let langDoc = lparser.parseFromString(langPage, "text/html");
        let langDropdown = ``;
        let langRows = langDoc.querySelectorAll('div[data-language-code][jsname]');
      console.log(langRows);
        const langRows_length=langRows.length;
        for(let i=1;i<langRows_length;i++){try{
            let code = langRows[i].getAttribute('data-language-code');
            let full = langRows[i].querySelector('[jsname]').textContent.trim();
            langList[code]=full;
            langDropdown+=`<option value="`+code+`">`+code+':'+full+`</option>`;
        }catch(e){continue;}}     
        document.getElementById('lang-to').innerHTML=langDropdown;
    }();
    
    
    
</script>



</table>
</body>
</html>
